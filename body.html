<body>
    <div id="title-container">
        <h1>AR家具配置<br>シミュレーション</h1>
        </div>

    <div id="overlay">

        <div id="help-modal">
            <div id="help-content-container">
                <button id="close-help-button">&times;</button>
                <div class="help-tabs">
                    <button class="help-tab-button active" data-tab="page1">基本操作</button>
                    <button class="help-tab-button" data-tab="page2">家具の操作</button>
                </div>
                <div class="help-page-content">
                    <div class="help-page active" id="page1">
                        <div class="help-section">
                            <h3>画面モード</h3>
                            <div class="help-grid">
                                <div class="help-card">
                                    <div class="icon-container">
                                        <svg viewBox="0 0 100 40"><rect x="1" y="1" width="98" height="38" rx="19" fill="rgba(0,0,0,0.5)" stroke="rgba(255,255,255,0.3)" stroke-width="2"/><rect x="3" y="3" width="46" height="34" rx="17" fill="white"/><text x="26" y="26" font-family="sans-serif" font-size="12" fill="black" font-weight="bold" text-anchor="middle">編集</text><text x="72" y="26" font-family="sans-serif" font-size="12" fill="#a0aec0" text-anchor="middle">鑑賞</text></svg>
                                    </div>
                                    <h4>モード切替</h4>
                                    <p>「編集」「鑑賞」を切り替えます。</p>
                                </div>
                                <div class="help-card">
                                    <div class="icon-container">
                                        <svg fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15m-3-3-3-3m0 0 3-3m-3 3h12" /></svg>
                                    </div>
                                    <h4>AR終了</h4>
                                    <p>AR体験を終了し、タイトル画面に戻ります。</p>
                                </div>
                            </div>
                        </div>
                        <div class="help-section">
                            <h3>編集モードの基本</h3>
                            <div class="help-grid">
                                <div class="help-card">
                                    <div class="icon-container">
                                        <svg fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" /></svg>
                                    </div>
                                    <h4>家具の追加</h4>
                                    <p>「+」ボタンから配置したい家具を選択します。</p>
                                </div>
                                <div class="help-card">
                                    <div class="icon-container">
                                        <svg fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125" /></svg>
                                    </div>
                                    <h4>家具の編集</h4>
                                    <p>家具を狙うと出るボタンで再選択できます。</p>
                                </div>
                                <div class="help-card">
                                    <div class="icon-container">
                                        <svg fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5" /></svg>
                                    </div>
                                    <h4>一覧に戻る</h4>
                                    <p>家具選択画面に戻ります。</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="help-page" id="page2">
                            <div class="help-section">
                                <h3>配置場所の確認</h3>
                                <div class="help-grid">
                                    <div class="help-card">
                                        <div class="icon-container">
                                            <svg fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><circle cx="12" cy="12" r="7.5" /></svg>
                                        </div>
                                        <h4>配置できます</h4>
                                        <p>地面に輪が表示されている場所に置けます。</p>
                                    </div>
                                    <div class="help-card">
                                        <div class="icon-container" style="color: #f56565;">
                                            <svg fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94 8.28 7.22z" clip-rule="evenodd" /></svg>
                                        </div>
                                        <h4>配置できません</h4>
                                        <p>❌印の場所には置けません。</p>
                                    </div>
                                </div>
                            </div>
                            <div class="help-section">
                                <h3>ジェスチャー操作</h3>
                                <div class="help-grid">
                                    <div class="help-card">
                                        <div class="icon-container">
                                            <svg viewBox="0 0 48 48" class="gesture-svg">
                                                <defs><path id="arc-path" d="M8,34 A16,16 0 0,1 40,34" fill="none"/></defs>
                                                <path d="M12,12 h24 v24 h-24z" stroke-width="1" opacity="0.5"/>
                                                <use href="#arc-path" stroke-dasharray="4 4" stroke-width="1.5" opacity="0.7"/>
                                                <circle cx="24" cy="23" r="5" class="finger" />
                                                <path d="M7 32 L10 35 L13 32 Z" class="arrow"/>
                                            </svg>
                                        </div>
                                        <h4>回転</h4>
                                        <p>1本指で家具を左右にドラッグして回します。</p>
                                    </div>
                                    <div class="help-card">
                                        <div class="icon-container">
                                            <svg viewBox="0 0 48 48" class="gesture-svg">
                                                <circle cx="18" cy="30" r="5" class="finger"/>
                                                <circle cx="30" cy="18" r="5" class="finger"/>
                                                <path d="M21,27 l-4,-4" stroke-width="1.5" stroke-dasharray="3 3"/>
                                                <path d="M15,21 l-3,-1 l2,3" class="arrow" />
                                                <path d="M27,21 l4,4" stroke-width="1.5" stroke-dasharray="3 3"/>
                                                <path d="M33,27 l3,1 l-2,-3" class="arrow"/>
                                            </svg>
                                        </div>
                                        <h4>拡大・縮小</h4>
                                        <p>2本指で広げたりつまんでサイズ変更。</p>
                                    </div>
                                    <div class="help-card">
                                        <div class="icon-container">
                                            <svg viewBox="0 0 48 48" class="gesture-svg">
                                                <path d="M14,18 h20 v12 h-20z" stroke-width="1" opacity="0.5"/>
                                                <circle cx="24" cy="24" r="5" class="finger"/>
                                                <circle cx="24" cy="24" r="9" stroke-width="1.5" stroke-dasharray="2 4" opacity="0.9" />
                                            </svg>
                                        </div>
                                        <h4>長押しで削除</h4>
                                        <p>家具を長押しすると削除の確認ができます。</p>
                                    </div>
                                </div>
                            </div>
                            <div class="help-section">
                                <h3>ボタン操作</h3>
                                <div class="help-grid">
                                    <div class="help-card">
                                        <div class="icon-container">
                                            <svg viewBox="0 0 48 48" stroke="#CBD5E0" fill="none">
                                                <text x="2" y="32" font-family="sans-serif" font-size="20" font-weight="bold" stroke="none" fill="#CBD5E0">-</text>
                                                <rect x="13" y="22" width="22" height="4" rx="2" stroke="none" fill="rgba(255,255,255,0.4)"></rect>
                                                <circle cx="24" cy="24" r="6" stroke-width="2" fill="white"></circle>
                                                <text x="36" y="32" font-family="sans-serif" font-size="20" font-weight="bold" stroke="none" fill="#CBD5E0">+</text>
                                            </svg>
                                        </div>
                                        <h4>サイズ変更</h4>
                                        <p>スライダーを動かして家具の大きさを変更します。</p>
                                    </div>
                                    <div class="help-card">
                                        <div class="icon-container">
                                            <svg fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" style="transform: rotate(180deg);">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="m15 15 6-6m0 0-6-6m6 6H9a6 6 0 0 1 0 12h3" />
                                            </svg>
                                        </div>
                                        <h4>回転</h4>
                                        <p>タップで45度、長押しで連続回転します。</p>
                                    </div>
                                    <div class="help-card">
                                        <div class="icon-container">
                                            <svg fill="none" viewBox="0 0 24 24" stroke-width="3" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" /></svg>
                                        </div>
                                        <h4>配置の確定</h4>
                                        <p>家具の位置や向き、大きさを決定します。</p>
                                    </div>
                                    <div class="help-card">
                                        <div class="icon-container">
                                            <svg fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.134-2.09-2.134H8.09a2.09 2.09 0 0 0-2.09 2.134v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" /></svg>
                                        </div>
                                        <h4>削除</h4>
                                        <p>選択中の家具をシーンから削除します。</p>
                                    </div>
                                </div>
                            </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="instruction-text">
            <span style="font-size: 1.25em; font-weight: bold;">床を認識中<span id="loading-dots"></span></span><br><br>
            カメラをゆっくりと<br>床に向けて<br>動かしてください
        </div>

        <button id="mode-switch-button">
            <span id="edit-mode-label" class="mode-label">編集モード</span>
            <span id="view-mode-label" class="mode-label">鑑賞モード</span>
        </button>

        <div id="top-left-controls">
            <button id="help-button" class="circle-button" style="display: none; width: 56px; height: 56px;">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" style="width: 28px; height: 28px;">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 5.25h.008v.008H12v-.008Z" />
                </svg>
            </button>
        </div>
        <div id="top-right-controls">
            <button id="exit-ar-button" class="circle-button" style="display: none; width: 56px; height: 56px;">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" style="width: 28px; height: 28px;">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15m-3-3-3-3m0 0 3-3m-3 3h12" />
                </svg>
            </button>
        </div>

        <div id="bottom-bar">
            <button id="add-button" class="circle-button"></button>
            <button id="edit-button" class="circle-button"></button>

            <div id="transform-controls">
                <div id="scale-slider-container">
                    <span class="slider-icon">-</span>
                    <div id="slider-track">
                        <div id="slider-handle"></div>
                    </div>
                    <span class="slider-icon">+</span>
                </div>
                <div class="rotation-button-group">
                    <button id="rotate-left-button" class="group-button"></button>
                    <button id="rotate-right-button" class="group-button"></button>
                </div>
            </div>
            <div id="decision-controls">
                <button id="delete-button" class="group-button"></button>
                <button id="confirm-button" class="group-button"></button>
            </div>
        </div>

        <div id="confirm-dialog" class="dialog-container">
            <div class="dialog-box">
                <p>この家具を削除しますか？</p>
                <div class="dialog-buttons">
                    <button id="confirm-delete-no">いいえ</button>
                    <button id="confirm-delete-yes">はい</button>
                </div>
            </div>
        </div>

        <div id="furniture-modal">
            <div id="furniture-modal-inner">
                <div id="search-container">
                    <input type="text" id="search-input" placeholder="家具を検索...">
                    <span class="search-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" style="width: 20px; height: 20px;">
                            <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
                        </svg>
                    </span>
                    <button class="clear-search-button" id="clear-search-button">&times;</button>
                    <ul id="search-suggestions" style="
                        position: absolute;
                        top: calc(100% + 5px);
                        left: 20px;
                        right: 20px;
                        background-color: rgba(45, 55, 72, 0.95);
                        border-radius: 8px;
                        list-style: none;
                        padding: 0;
                        margin: 0;
                        max-height: 150px;
                        overflow-y: auto;
                        border: 1px solid rgba(255, 255, 255, 0.2);
                        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
                        display: none;
                        z-index: 10;
                    "></ul>
                </div>
                <div id="category-tabs">
                </div>
                <div id="furniture-grid">
                </div>
                <button id="close-modal-button">&times;</button>
            </div>
        </div>

    </div>

    <a-scene
        webxr="requiredFeatures: hit-test; optionalFeatures: dom-overlay; domOverlay: #overlay;"
        ar-hit-test-manager
        furniture-manager
        cursor="rayOrigin: mouse; fuse: false;"
        raycaster="objects: .collidable; far: 10;"
        gltf-model-progress>
        <a-camera id="camera" position="0 1.6 0" look-controls>
            <a-entity id="reticle"
                geometry="primitive: ring; radiusOuter: 0.2; radiusInner: 0.15;"
                material="color: white; shader: flat; transparent: true; opacity: 0.8;"
                position="0 0 -3"
                rotation="-90 0 0"
                visible="false">
            </a-entity>
            <a-image id="cross-mark"
                src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNTYiIGhlaWdodD0iMjU2IiB2aWV3Qm94PSIwIDAgMjU2IDI1NiI+PGNpcmNsZSBjeD0iMTI4IiBjeT0iMTI4IiByPSIxMjgiIGZpbGw9InJnYmEoMjA0LCAwLCAwLCAwLjgpIi8+PHBhdGggZD0iTTE5Mi4xNDIgNjMuODU4TDYzLjg1OCAxOTIuMTQyTTYzLjg1OCAzMi44NTdMMTkyLjE0MiAxMjYuMTQzIiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjI1IiBzdHJva2UtbGluZWNhcD0icm91bmQiLz48L3N2Zz4="
                position="0 0 -3"
                scale="0.5 0.5 1"
                visible="false"></a-image>
        </a-camera>

        <a-assets timeout="60000">
            <a-asset-item id="chair-model" src="chair.glb"></a-asset-item>
            <a-asset-item id="bookshelf-model" src="bookshelf.glb"></a-asset-item>
            <a-asset-item id="stand-model" src="stand.glb"></a-asset-item>
            </a-assets>

    </a-scene>
</body>
</html>